#!/usr/bin/env php
<?php
/**
 *
 * Author: abel
 * Email:abel.zhou@hotmail.com
 * Date: 2018/12/12
 * Time: 11:42
 */

define("FINISHERMAN_PATH", __DIR__);
$workPath = getcwd();
$paths = array(
    $workPath . "/Conf/local",
    $workPath . "/Conf/rls",
    $workPath . "/Conf/test",
    $workPath . "/Model/DBName",
    $workPath . "/Module/DBName",
);

foreach ($paths as $path) {
    if (!mkdir($path, 0755, true) && !is_dir($path)) {
        throw new \RuntimeException(sprintf('Directory "%s" was not created', $path));
    }
}

$files = array(
    "/Conf/local/cache.yml",
    "/Conf/local/config.yml",
    "/Conf/local/db.yml",
    "/Model/DBName/Tablename.php",
    "/Module/DBName/Servicename.php",
    "/composer.json",
    "/bootstrap.php"
);

foreach ($files as $file) {
    copy(FINISHERMAN_PATH . "/Template" . $file, $workPath . $file);
    chmod($workPath . $file, 0755);
}

echo "\033[32m[Building completed]\033[0m\n";
$output = null;
$command = <<<'CMD'
    if  command -v composer > /dev/null; then
        composer install --optimize-autoloader
    else
        echo "failed";
    fi
CMD;
if (function_exists("exec")) {
    exec($command, $output);
    if (!empty($output) && $output[0] === 'failed') {
        echo "Composer command has not found.\nYou must execute \033[32m[\"composer install --optimize-autoloader\"]\033[0m for build project.\n";
    }
}

echo "\033[32m[Finished]\033[0m\n";

